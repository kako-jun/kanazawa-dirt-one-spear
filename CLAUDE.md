# CLAUDE.md - プロジェクトナビゲーション

このドキュメントは、本プロジェクトの全体像と詳細ドキュメントへの導線を提供します。

## プロジェクト概要

**金沢ダート一本槍（Kanazawa Dirt One Spear）** - 金沢競馬に特化したAI予想システム

### 特徴
- 3連単を1点のみ予想（一本槍スタイル）
- 実購入結果の記録・統計表示
- 趣味・無料・応援目的（非営利）

### プロジェクトの使命
**金沢競馬場の存続を支援する**
- 馬券購入を促進し、売上に貢献
- 馬や騎手、競馬場への愛着を育む
- 「応援」としての馬券購入文化を醸成

---

## ドキュメント構成

プロジェクトの詳細ドキュメントは `.claude/` ディレクトリに集約されています。

### 📊 データ収集 (data-collection/)

**どうやって情報を集めるか**

- `.claude/data-collection/data_acquisition_plan.md` - データ収集戦略全般
- `.claude/data-collection/scraping_notes.md` - スクレイピング実装メモ

### 🔬 分析手法 (analysis/)

**どうやって分析するか**

- `.claude/analysis/prediction.md` - AI予想手法（LightGBM/Deep Learning、オッズバイアス実験、時系列検証）
- `.claude/analysis/analysis.md` - 統計分析手法（公平性検証、オカルト検証、馬タイプクラスタリング、ユニーク特徴量）

### 🎨 プレゼンテーション (presentation/)

**どうやって見せるか**

- `.claude/presentation/frontend.md` - フロントエンド設計（レトロデザイン、購入促進、愛着機能、競馬場統計）

---

## プロジェクト進捗

### ✅ 完了したフェーズ

**Phase 1: データ収集** (2025-11-15 完了)
- 2015-2025年の金沢競馬レースデータをYAML形式で収集（17,451ファイル）
  - result.yaml: 8,718レース
  - deba.yaml: 8,733レース（出馬表データ）
- データベーススキーマ定義完了
- 全レースデータのDB格納完了（8,718レース、12,924頭）
- **データ品質修正完了** (2025-11-15)
  - 馬場状態抽出バグ修正（正規表現による正確な抽出）
  - 天候データ抽出修正（正規表現による正確な抽出）
  - 配当データBRタグ連結バグ修正（全配当タイプで正確な抽出）
  - データベースパスの統一（単一の絶対パスに統一）
  - 最終データ品質: 馬場状態53%良/17%不良/15%重/15%稍重、配当データ100%正確

### 🚧 現在のフェーズ

**Phase 2: 分析・予想モデル構築** (2025-11-15開始)

**完了した作業:**
- ✅ **データベーススキーマ正規化** (2025-11-15)
  - JSON型カラムを排除し完全な第3正規形を実現
  - `race_performances`テーブル追加: 個別馬の結果（76,879件）
    - finish_position, popularity, time, margin, last_3f/4f
    - gate_number, horse_number, corner positions
  - `payouts`テーブル追加: 配当情報（61,001件）
    - 7種類の配当タイプ（win/place/quinella/exacta/wide/trio/trifecta）
    - combo, payout amount, popularity
  - `results`テーブル簡略化: JSON型カラム削除
  - パフォーマンス改善: SQL直接クエリで瞬時に分析可能（従来は8,733ファイル読込で数分）

- ✅ **基礎統計分析完了** (2025-11-15)
  - `analysis/basic_statistics.py`作成・実行成功
  - データ規模確認: 8,733レース、12,924頭、281騎手、308調教師（2015-2025年）
  - 馬場状態分布: 良53.32%、稍重14.71%、重15.05%、不良16.92%
  - 人気別勝率: 1番人気47.84%、2番人気20.57%
  - 枠番別勝率: ほぼ均等（10.52%-11.86%）、わずかに8枠有利
  - 配当統計: 三連単平均5,202円（最高1,032,020円）、単勝平均636円

**次のステップ:**
- 🔄 騎手ランキング分析
- 🔄 馬場状態×距離の交互作用分析
- 🔄 LightGBM予想モデルの実装
- 🔄 オッズあり/なしモデルの比較実験

### 📋 今後のフェーズ

**Phase 3: フロントエンド実装**
- レトロデザインのUI構築
- 予想表示・結果記録機能
- 統計ダッシュボード

**Phase 4: 本番運用**
- 実データでの予想開始
- 結果追跡・改善サイクル

---

## 技術スタック

**フロントエンド**: Next.js 14, TypeScript, Tailwind CSS
**バックエンド**: FastAPI, Python 3.11+, SQLAlchemy
**データベース**: SQLite (開発), PostgreSQL (本番検討)
**機械学習**: LightGBM, scikit-learn, (PyTorch/TensorFlow 検討中)

---

## クイックスタート

```bash
# バックエンド起動
cd backend
poetry install
poetry run uvicorn app.main:app --reload

# フロントエンド起動
cd frontend
npm install
npm run dev
```

---

## 開発方針

- **情報欠落厳禁**: 試行錯誤の過程もすべて記録
- **段階的実装**: MVP → 機能追加の順で開発
- **責任ある運営**: ギャンブル依存防止、法令遵守
- **オープンな実験**: 成功・失敗すべてコンテンツ化

---

## ライセンス・法的配慮

- 趣味・非営利プロジェクト
- 公式データの利用規約遵守
- ギャンブル依存防止の注意書き表示
- 「必ず当たる」等の誤認表現禁止

---

**最終更新**: 2025-11-15 (Phase 2 基礎統計分析完了)
**作成者**: d131
