# 追加EDA結果 - 2025-11-14

## 実行概要

**実行日時**: 2025-11-14 20:43:30
**目的**: オッズ・欠損値・結果データの詳細確認

---

## 🔍 重要な発見

### 1. オッズデータの状況

**❌ オッズデータは完全に欠損**

```
総エントリー数: 79,283件
オッズあり: 0件（0.0%）
```

**全年度でオッズデータなし（2015-2025年すべて0%）**

**原因の可能性**:
1. YAMLファイルにオッズ情報が含まれていない
2. オッズは発走前のリアルタイム情報のため、過去レースの取得が困難
3. スクレイピング元のページにオッズが表示されていない

**影響**:
- ✅ オッズ無視モデルの構築は可能（むしろ必須）
- ❌ オッズ考慮モデルとの比較実験は不可能（現状では）
- ✅ 「AI独自の判断」を純粋に評価できる

**対応方針**:
- prediction.md の「パターンA: オッズ完全無視型AI」を優先実装
- 将来的にリアルタイムオッズ取得を検討（本番運用時）

---

### 2. 配当データの状況

**✅ 配当データは99.75%存在！**

```
結果あり: 8,718レース / 8,733レース（99.83%）
配当データあり: 8,696レース / 8,718レース（99.75%）
1着データあり: 8,717レース（99.99%）
```

**前回サマリーの誤りを訂正**:
- 前回: 「配当データが完全欠損」← 誤り
- 実際: 配当データはほぼ完全に存在

**これにより可能になること**:
- ✅ 回収率の正確な計算
- ✅ 予想システムの実戦評価
- ✅ 的中率と回収率の両面での検証

---

### 3. 馬体重データ

**✅ 馬体重データは98.87%存在**

```
総エントリー: 79,283件
馬体重あり: 78,391件（98.87%）
体重変化あり: 70,069件（88.38%）
```

**特徴量として使用可能**:
- 馬体重
- 体重変化
- 前走からの増減傾向

---

### 4. 性別・年齢データの欠損

**⚠️ 50%が欠損**

```
出走馬総数: 6,601頭
性別あり: 3,301頭（50.01%）
年齢あり: 3,301頭（50.01%）
性別がfemale: 3,301頭
性別がNone: 3,300頭
```

**解釈**:
- 性別が記録されている馬はすべて「female（牝馬）」
- 性別がNoneの馬は牡馬・騙馬の可能性が高い
- つまり「female」「None」を「牝馬」「牡馬・騙馬」として扱える

**特徴量としての利用**:
- `is_female` フラグとして使用可能（1 or 0）
- 年齢は50%しかないが、使える馬には有効

**出走回数上位馬のサンプル**:
```
コスモアリーナ: gender=None, age=NaN, 148回出走
カジノノーブル: gender=None, age=NaN, 142回出走
ディアルレイル: gender=female, age=10, 139回出走
```

---

### 5. 馬場状態データの異常

**❌ 「不良」が94.57%**

```
不良: 8,259レース（94.57%）
重: 474レース（5.43%）
```

**最新レース10件すべてが「不良」**

**明らかな異常の原因**:
1. フィールド名のミスマッピング
2. デフォルト値が「不良」
3. 「良」「稍重」が正しく取得できていない

**今後の対応**:
- YAMLファイルの `track_condition` 値を確認
- 正しい値（良/稍重/重/不良）にマッピング修正

---

## 📊 データ充実度サマリー

| データ項目 | 存在率 | 状態 | 予想モデルへの影響 |
|-----------|-------|------|----------------|
| **レース基本情報** | 100% | ✅ 良好 | 距離、天候、開催日などすべて使用可能 |
| **結果データ** | 99.83% | ✅ 良好 | 着順データ完全、評価可能 |
| **配当データ** | 99.75% | ✅ 良好 | 回収率計算可能 |
| **馬体重** | 98.87% | ✅ 良好 | 特徴量として使用可能 |
| **調教師** | 100% | ✅ 良好 | 調教師統計を特徴量化可能 |
| **騎手** | 100% | ✅ 良好 | 騎手統計を特徴量化可能 |
| **オッズ** | 0% | ❌ 欠損 | オッズ無視モデルのみ構築可能 |
| **性別** | 50.01% | ⚠️ 注意 | female/Noneの二値として使用可能 |
| **年齢** | 50.01% | ⚠️ 注意 | あるデータのみ使用 |
| **馬場状態** | 100% | ❌ 異常 | 修正が必要 |

---

## 🎯 次のステップ（優先度順）

### 優先度A（必須・即実施）

1. **特徴量エンジニアリングの開始**
   - ✅ オッズなしで十分なデータが揃っている
   - 馬体重、騎手統計、過去成績、距離適性などを特徴量化
   - 配当データがあるので回収率評価が可能

2. **LightGBM基本実装**
   - オッズ無視モデル（パターンA）の構築
   - 時系列交差検証の実装
   - 的中率・回収率の評価

### 優先度B（改善・並行実施）

3. **馬場状態データの修正**
   - YAMLファイルの確認
   - パースロジックの修正
   - データベース再投入

4. **性別データの解釈整理**
   - `is_female` フラグとして特徴量化
   - None = 牡馬・騙馬と仮定して使用

### 優先度C（将来的検討）

5. **オッズデータの取得方法検討**
   - リアルタイムAPI調査
   - 本番運用時のオッズ取得戦略
   - オッズ考慮モデルとの比較実験（将来）

---

## 💡 重要な気づき

### 予想システム構築への影響

**良いニュース**:
1. **配当データが存在** → 回収率で評価できる
2. **結果データほぼ完全** → 的中率の正確な計算
3. **馬体重・騎手・調教師データ充実** → 豊富な特徴量

**制約**:
1. **オッズなし** → オッズ考慮モデルは当面不可
2. **馬場状態異常** → 要修正（ただし天候データは正常）

### prediction.md の実装方針の再確認

**当初の計画**:
- パターンA（オッズ無視）vs パターンB（オッズ考慮）の比較実験

**現実的な方針**:
- 👉 **パターンA（オッズ無視）を先行実装**
- データの制約により、これが唯一の選択肢
- むしろ「AIの独自判断」を純粋に評価できる好機
- 将来的にオッズ取得できたら比較実験を実施

---

## 📈 データ品質評価

**総合評価: B+ （予想モデル構築は十分可能）**

**理由**:
- ✅ 核心的なデータ（着順、配当）は完璧
- ✅ 特徴量に使えるデータは豊富
- ⚠️ 一部のデータに修正が必要だが、致命的ではない
- ❌ オッズデータなしは残念だが、別の価値がある

**結論**:
Phase 2（分析・予想モデル構築）に進む準備は整っている。

---

**作成者**: Claude
**作成日**: 2025-11-14 20:43:30
**データベース**: backend/data/kanazawa_dirt_one_spear.db（327MB）
