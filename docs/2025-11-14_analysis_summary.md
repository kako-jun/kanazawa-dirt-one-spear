# 分析結果サマリー - 2025-11-14

## 実施した分析

1. **基本統計分析** (`basic-stats/2025-11-14_basic_stats.md`)
2. **ベンフォードの法則による公平性検証** (`fairness/2025-11-14_benfords_law.md`)

---

## 主要な発見

### 1. データの概要

- **期間**: 2015年4月〜2025年11月（約10年半）
- **レース数**: 8,733レース
- **開催日数**: 769日
- **出走エントリー**: 79,283件
- **馬**: 12,924頭
- **騎手**: 281人
- **調教師**: 308人

### 2. 年間開催の安定性

年別レース数は非常に安定している:
- 2015年: 751レース
- 2016-2023年: 800-822レース（平均811レース）
- 2024年: 848レース（最多）
- 2025年: 671レース（11月時点）

**解釈**: 金沢競馬場の開催は安定しており、2024年は過去最多の開催となっている。

### 3. 距離分布の特徴

- **1500m**: 46.89%（4,095レース）
- **1400m**: 45.39%（3,964レース）
- **その他**: 7.72%（674レース）

**解釈**: 金沢競馬は1400m/1500mに極端に特化している。この2距離で全レースの92%を占める。

**モデル構築への示唆**:
- 距離を特徴量として使う場合、1400m/1500mの2値ダミー変数で十分
- 他の距離は少数なので、過学習に注意が必要
- もしくは「短距離（〜1400m）/中距離（1500-1700m）/長距離（1900m〜）」の3カテゴリに集約

### 4. 天候・馬場状態

**天候分布**:
- 晴: 45.44%
- 曇: 34.72%
- 雨: 13.67%
- 雪: 6.17%

**馬場状態**:
- 不良: 94.57% ← **異常値！データ確認必要**
- 重: 5.43%

**⚠️ 重要な問題点**: 馬場状態で「不良」が94.57%となっているのは明らかに異常。おそらく以下の原因が考えられる:
1. データ取得時のフィールド名の誤解釈
2. デフォルト値が「不良」になっている
3. 「良」「稍重」「重」「不良」のマッピングミス

**今後のアクション**:
- YAMLファイルのtrack_conditionフィールドを再確認
- データベース投入ロジックの確認
- 正しいマッピングに修正

### 5. 馬の出走実績

**出走回数TOP5**:
1. コスモアリーナ: 148回
2. カジノノーブル: 142回
3. ディアルレイル: 139回
4. カトリーヌスリジエ: 121回
5. コウユーカゲムシャ: 118回

**解釈**: 10年半で148回出走は驚異的。年間平均14回出走。

**性別分布**:
- female: 50.01%
- None: 49.99%

**⚠️ 問題点**: 性別が半分Noneになっている。おそらく:
- 牡馬・セン馬が"None"にマッピングされている
- または未記入のデータが多い

**今後のアクション**:
- gender フィールドの正しい値（牡/牝/騙）を確認

### 6. 騎手の実績

**騎乗回数TOP5**:
1. 栗原大: 5,579回
2. 青柳正: 5,307回
3. 中島龍: 5,202回
4. 藤田弘: 4,456回
5. 柴田勇: 4,172回

**解釈**: トップ3騎手が5,000回以上騎乗。金沢競馬を支える主力騎手。

**モデル構築への示唆**:
- 騎手の実績（勝率、連対率）は重要な特徴量になる
- 上位騎手と下位騎手で大きく成績が異なる可能性
- 「騎手×距離」「騎手×馬場状態」などの交互作用も有効かも

### 7. 1着馬の馬番分布

| 馬番 | 勝利数 | 割合 |
|------|--------|------|
| 1    | 940    | 10.78% |
| 2    | 991    | 11.37% |
| 3    | 998    | 11.45% |
| 4    | 970    | 11.13% |
| 5    | 1,004  | 11.52% ← **最多** |
| 6    | 906    | 10.39% |
| 7    | 905    | 10.38% |
| 8    | 851    | 9.76% |
| 9    | 603    | 6.92% |
| 10   | 386    | 4.43% |
| 11   | 133    | 1.53% |
| 12   | 30     | 0.34% |

**解釈**:
- 1-8番は比較的均等（9.76%〜11.52%）
- 9番以降は急激に減少 → これは出走頭数が少ないレースが多いため
- 12頭立てのレースは少数派

**モデル構築への示唆**:
- 馬番そのものは特徴量として弱い（頭数の影響が大きい）
- 「枠番」の方が有効な可能性（内枠/外枠）
- または「出走頭数で正規化した馬番」（例: 馬番/出走頭数）

### 8. 配当データの欠損

**❌ 重大な問題**: 3連単配当のデータが全く存在しない

**原因**:
- resultsテーブルの payout_trifecta フィールドが全てNULL
- YAMLファイルに配当データがない、またはパース時に取得できていない

**影響**:
- 回収率の計算ができない
- 実際の予想システムの評価ができない

**今後のアクション**:
1. YAMLファイルに配当データが含まれているか確認
2. 含まれていなければ、結果ページから配当をスクレイピング
3. 含まれているがパースできていないなら、yaml_to_db.py を修正

---

## ベンフォードの法則による公平性検証

### 結果

#### 1着馬の馬番

- **カイ二乗値**: 1819.95
- **p値**: 0.000000
- **結論**: ❌ ベンフォードの法則から大きく逸脱

**解釈**:
- これは**不正ではなく、競馬の構造的特徴**
- 馬番は1〜12の範囲に制限されている
- 出走頭数が少ないレースでは大きな馬番が存在しない
- ベンフォードの法則は「自然発生的で範囲が広い数値」に適用されるべき

**結論**: 予想通りの結果。問題なし。

#### 馬体重

- **カイ二乗値**: 521769.75
- **p値**: 0.000000
- **結論**: ❌ ベンフォードの法則から大きく逸脱

**解釈**:
- これも**不正ではなく、馬体重の生物学的特徴**
- 馬体重は300〜500kg台に集中
- 最初の桁は「3」「4」「5」がほぼ全て
- 観測: 4が85.08%、5が12.17%、3が2.75%

**結論**: 予想通りの結果。問題なし。

### ベンフォードの法則の適用限界

今回の検証で、**ベンフォードの法則は競馬データには不適**であることが確認された。

理由:
- 馬番は1〜12の狭い範囲
- 馬体重は300〜500kgに集中
- レース距離も固定値（1400m, 1500m等）

**今後の公平性検証には別の手法を使うべき**:
- オッズ分布の妥当性検証
- 騎手・馬の成績の時系列一貫性
- 異常な結果の検出（統計的外れ値検出）

---

## 次のステップ

### 優先度: 高

1. **データ品質の修正**
   - [ ] 馬場状態データの確認と修正
   - [ ] 性別データの確認と修正
   - [ ] 配当データの取得と格納

2. **特徴量エンジニアリング**
   - [ ] 基本特徴量の設計（馬番、騎手、距離、馬場、天候など）
   - [ ] 過去成績の集計特徴量（騎手勝率、馬の連対率など）
   - [ ] 交互作用特徴量（騎手×距離、馬×馬場状態など）

3. **予想モデル構築**
   - [ ] ベースラインモデル（人気順予想）の作成
   - [ ] LightGBM Rankerの実装（オッズなし版）
   - [ ] 時系列クロスバリデーションの実装

### 優先度: 中

4. **詳細分析**
   - [ ] 騎手別成績分析
   - [ ] 馬別成績分析
   - [ ] 距離別傾向分析
   - [ ] 月別・天候別傾向分析

5. **可視化**
   - [ ] 年間レース数推移グラフ
   - [ ] 馬番別勝率グラフ
   - [ ] 騎手別成績グラフ

---

## まとめ

### 良い点

✅ 10年半分の安定したデータが存在
✅ レース開催は年間800回前後で安定
✅ 主要な情報（馬、騎手、レース結果）は揃っている

### 課題

⚠️ 馬場状態データに異常値（要修正）
⚠️ 性別データが半分欠損（要確認）
❌ 配当データが完全欠損（要取得）

### 総評

**データベースは基本的に良好だが、いくつかの修正が必要**。特に配当データは予想システムの評価に必須なので、最優先で取得すべき。

馬場状態と性別データの問題は、YAMLパースまたはDB投入のロジックの修正で解決できる見込み。

分析基盤は整ったので、次は特徴量エンジニアリングと予想モデルの構築に進める。

---

**作成者**: Claude
**作成日**: 2025-11-14
**分析対象DB**: backend/kanazawa_dirt_one_spear.db（327MB）
