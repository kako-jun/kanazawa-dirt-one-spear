# EDA総合サマリー（更新版） - 2025-11-14

## 📊 データベース概要

**期間**: 2015年4月〜2025年11月（約10年半）
**データベースサイズ**: 327MB

### 基本統計

| 項目 | 件数 |
|------|------|
| レース数 | 8,733 |
| 開催日数 | 769日 |
| 出走エントリー | 79,283件 |
| 馬 | 12,924頭（出走馬: 6,601頭） |
| 騎手 | 281人 |
| 調教師 | 308人 |

---

## ✅ データ品質評価

### 総合評価: **B+（予想モデル構築に十分）**

### データ充実度マトリクス

| カテゴリ | 項目 | 存在率 | 評価 | 備考 |
|---------|------|--------|------|------|
| **レース情報** | 日時・距離・天候 | 100% | ✅ 完璧 | すべて使用可能 |
| **結果データ** | 着順（1-3着） | 99.9% | ✅ 完璧 | 予想評価に十分 |
| **配当データ** | 3連単配当 | 99.75% | ✅ 完璧 | 回収率計算可能 |
| **馬体重** | 体重・増減 | 98.87% | ✅ 良好 | 特徴量として使用可 |
| **騎手・調教師** | 全データ | 100% | ✅ 完璧 | 統計値の算出可能 |
| **性別** | 出走馬の性別 | 50.01% | ⚠️ 注意 | female/Noneの二値 |
| **年齢** | 出走馬の年齢 | 50.01% | ⚠️ 注意 | 半分は使用可能 |
| **オッズ** | 単勝オッズ | 0% | ❌ 欠損 | オッズ無視モデルのみ |
| **馬場状態** | 良/稍重/重/不良 | 100% | ❌ 異常 | データ修正が必要 |

---

## 🎯 重要な発見

### 1. 配当データは完璧に存在

**✅ 99.75%のレースで3連単配当あり**

- 結果データ: 8,718 / 8,733レース（99.83%）
- 配当データ: 8,696 / 8,718レース（99.75%）

**これにより可能**:
- 的中率の計算
- 回収率の計算
- 実戦シミュレーション

### 2. オッズデータは完全欠損

**❌ 全79,283エントリーでオッズなし（0%）**

**影響**:
- オッズ考慮モデルは構築不可（現時点）
- オッズ無視モデル（パターンA）を優先実装
- 「AI独自の判断」を純粋に評価できる

**原因推測**:
- YAMLファイルにオッズ情報が含まれていない
- 過去レースのオッズは取得困難（リアルタイム情報）

### 3. 性別データの解釈

**50%が"None"、50%が"female"**

**実態**:
- `female` = 牝馬
- `None` = 牡馬・騙馬

**特徴量化**:
- `is_female` フラグ（0 or 1）として使用可能

### 4. 馬場状態データの異常

**❌ 「不良」が94.57%**

- 不良: 8,259レース
- 重: 474レース
- 良・稍重: 0レース

**明らかな異常** → YAMLパース修正が必要

---

## 📈 レース開催の特徴

### 年別レース数（安定）

```
2015年: 751レース
2016-2023年: 800-822レース（平均811）
2024年: 848レース（最多）
2025年: 671レース（11月時点）
```

### 距離分布（極端な特化）

```
1500m: 46.89%（4,095レース）
1400m: 45.39%（3,964レース）
その他: 7.72%（674レース）
```

**92%が1400m/1500mの2距離に集中**

**特徴量設計への示唆**:
- 距離は2値ダミー変数で十分
- または「短距離/中距離/長距離」の3カテゴリ

### 天候分布

```
晴: 45.44%
曇: 34.72%
雨: 13.67%
雪: 6.17%
```

---

## 🏇 馬・騎手の実績

### 出走回数TOP5（馬）

1. コスモアリーナ: 148回
2. カジノノーブル: 142回
3. ディアルレイル: 139回
4. カトリーヌスリジエ: 121回
5. コウユーカゲムシャ: 118回

**10年半で148回出走 = 年平均14回**

### 騎乗回数TOP5（騎手）

1. 栗原大: 5,579回
2. 青柳正: 5,307回
3. 中島龍: 5,202回
4. 藤田弘: 4,456回
5. 柴田勇: 4,172回

**トップ3騎手が5,000回以上 = 金沢競馬の主力**

---

## 🎲 1着馬の馬番分布

| 馬番 | 勝利数 | 割合 |
|------|--------|------|
| 1 | 940 | 10.78% |
| 2 | 991 | 11.37% |
| 3 | 998 | 11.45% |
| 4 | 970 | 11.13% |
| 5 | 1,004 | **11.52%** ← 最多 |
| 6 | 906 | 10.39% |
| 7 | 905 | 10.38% |
| 8 | 851 | 9.76% |
| 9 | 603 | 6.92% |
| 10 | 386 | 4.43% |
| 11 | 133 | 1.53% |
| 12 | 30 | 0.34% |

**解釈**:
- 1-8番は比較的均等
- 9番以降は急減（出走頭数が少ないレースが多い）

**特徴量への示唆**:
- 馬番そのものは弱い（頭数の影響大）
- 枠番の方が有効な可能性
- または「馬番 / 出走頭数」で正規化

---

## 🚀 次のステップ（Phase 2開始）

### ✅ 準備完了した項目

1. **データ品質確認** → 完了
2. **基本統計把握** → 完了
3. **欠損値パターン把握** → 完了

### 👉 次に実施すべき作業（優先度A）

#### 1. 特徴量エンジニアリング

**基本特徴量**:
- 馬番、枠番、出走頭数
- 距離、天候
- 馬体重、体重変化
- 性別（is_female）

**統計特徴量**:
- 騎手勝率、連対率
- 馬の過去成績（平均着順、勝率）
- 調教師の成績
- 距離適性（馬×距離の勝率）

**交互作用特徴量**:
- 騎手×距離
- 馬×馬場状態（修正後）
- 騎手×馬のコンビ

#### 2. LightGBM予想モデルの実装

**ステップ**:
1. 特徴量データフレームの作成
2. 時系列クロスバリデーションの実装
3. LightGBM Rankerの学習
4. 的中率・回収率の評価

**目標**:
- 的中率: 30%以上（初期目標）
- 回収率: 70%以上

#### 3. ベースラインモデルの構築

**比較対象**:
- ランダム予想
- 人気順予想（オッズなしなので実装不可）
- 枠番順予想

### 優先度B（並行実施）

#### 4. データ修正

- 馬場状態データの修正
- YAMLパースロジックの確認

#### 5. 詳細分析

- 騎手別成績分析
- 馬別成績分析
- 距離別傾向分析

---

## 💡 prediction.mdの実装方針（再確認）

### 当初計画

- パターンA（オッズ無視）vs パターンB（オッズ考慮）の比較実験

### 現実的な方針

**👉 パターンA（オッズ無視）を先行実装**

**理由**:
1. オッズデータが存在しない
2. むしろ「AI独自の判断」を純粋に評価できる
3. 配当データがあるので回収率評価は可能

**将来的に**:
- 本番運用時にリアルタイムオッズを取得
- オッズ考慮モデルとの比較実験を実施

---

## 📝 まとめ

### 良い点

✅ 10年半分の安定したデータ
✅ 着順・配当データがほぼ完璧
✅ 特徴量に使えるデータは豊富
✅ 予想モデル構築に必要なデータは揃っている

### 課題

⚠️ オッズデータなし（オッズ無視モデルのみ）
⚠️ 馬場状態データに異常（修正が必要）
⚠️ 性別・年齢データが50%欠損（ただし使える）

### 総評

**Phase 2（予想モデル構築）に進む準備は整っている。**

オッズがないという制約はあるが、むしろ「AI独自の判断」を評価する機会。
配当データがあるため、実戦的な回収率評価が可能。

次のステップ:
1. 特徴量エンジニアリング
2. LightGBM実装
3. 時系列検証

---

**作成者**: Claude
**作成日**: 2025-11-14
**関連ドキュメント**:
- `docs/2025-11-14_analysis_summary.md`（基本統計）
- `docs/eda/2025-11-14_additional_eda.md`（詳細EDA）
- `.claude/analysis/prediction.md`（予想手法）
