# 作戦１「王道」バックテスト分析レポート

**実行日**: 2025-11-20
**テスト期間**: 2024年4月2日 〜 2025年11月10日
**レース数**: 1,508レース

---

## エグゼクティブサマリー

### 結論
**現状の1点買い戦略では収益化は困難**

- オッズなしモデル: 的中率2.59%、ROI 16.89%、**-83%損失**
- オッズありモデル: 的中率5.24%、ROI 26.95%、**-73%損失**

### 主な問題点
1. **人気馬偏重** - 平均配当514円では採算が合わない
2. **1点買いの限界** - 惜しい予想が多いが、完全一致でなければ0円
3. **期待値マイナス** - 5.24% × 514円 = 26.9円（投資100円に対して）

### 改善の可能性
✅ モデルの予測精度自体は悪くない（上位馬の選定は的確）
✅ 購入方法の工夫で改善余地あり
⚠️ 根本的な戦略見直しが必要

---

## 詳細結果

### モデル1: オッズなしモデル

| 指標 | 値 |
|------|-----|
| 総レース数 | 1,508 |
| 的中数 | 39 |
| 的中率 | 2.59% |
| 総投資額 | 150,800円 |
| 総払戻 | 25,470円 |
| 収支 | **-125,330円** |
| ROI | 16.89% |
| 平均配当（的中時） | 670円 |

**評価**:
- ❌ 的中率が低すぎる（約39レースに1回）
- ❌ 平均配当が低い（人気馬に偏重）
- ❌ 実用性なし

### モデル2: オッズありモデル

| 指標 | 値 |
|------|-----|
| 総レース数 | 1,508 |
| 的中数 | 79 |
| 的中率 | **5.24%** |
| 総投資額 | 150,800円 |
| 総払戻 | 40,640円 |
| 収支 | **-110,160円** |
| ROI | 26.95% |
| 平均配当（的中時） | 514円 |

**評価**:
- ✓ 的中率はオッズなしの2倍（約19レースに1回）
- ❌ それでも収益化には不十分
- ⚠️ 平均配当514円は人気上位の証拠

---

## 問題分析

### 1. 損益分岐点の計算

**必要な条件**:
```
期待値 = 的中率 × 平均配当 ≥ 投資額

損益分岐点の平均配当 = 100円 / 0.0524 = 1,908円
```

**現実**:
- 実際の平均配当: **514円**
- 必要な配当: **1,908円**
- **ギャップ: -1,394円（73%不足）**

### 2. 人気馬偏重の問題

平均配当514円は、概ね**1-2番人気の組み合わせ**に相当します。

**仮説**:
- モデルは確率的に正しい予測をしている
- しかしオッズも同様の予測をしている
- 結果、**人気馬＝低配当**となり、期待値がマイナス

**検証必要**:
- 予想馬番と人気順位の相関
- 人気薄を選べているか

### 3. 惜しい予想の多さ

サンプル抽出:
```
予想: (2, 1, 6) → 実際: (2, 1, 3)  # 1着2着的中
予想: (1, 3, 5) → 実際: (1, 3, 6)  # 1着2着的中
予想: (7, 4, 5) → 実際: (7, 5, 2)  # 1着3着的中
```

**示唆**:
- モデルは上位馬の選定は的確
- しかし完全な順位予測は困難
- **3連単1点買いは厳しすぎる**

---

## 改善策

### 戦略A: 購入点数の拡大

#### A-1: ボックス買い（3頭）
上位3頭の全順列を購入（6点）

**期待効果**:
- 的中率: 5.24% → **15-20%**（推定）
- 投資額: 6倍
- ROI改善の可能性あり

**リスク**:
- 配当が1/6になるわけではない（組み合わせで変動）
- 投資額増加

#### A-2: 流し買い（1着固定）
1着を予想馬に固定、2着3着を上位4頭から選択（12点）

**期待効果**:
- 1着的中率が高ければ有効
- 投資額: 12倍

#### A-3: フォーメーション買い
- 1着候補: 上位2頭
- 2着候補: 上位3頭
- 3着候補: 上位4頭
- 購入点数: 2×2×3 = 12点（重複除く）

### 戦略B: 期待値ベースの選択

#### B-1: 配当予測の追加
- 各組み合わせの予想配当を計算
- 期待値 = 的中確率 × 予想配当
- **期待値 > 投資額** の場合のみ購入

#### B-2: オッズギャップ手法
- モデル予測確率 vs オッズから逆算した確率
- ギャップが大きい馬を狙う
- いわゆる「バリューベット」

### 戦略C: モデル改善

#### C-1: ランク学習への移行
- LambdaMART/LambdaRankの導入
- 順位を直接予測
- 1着確率だけでなく2着3着も予測

#### C-2: クラス重み付け
- 現状のRecall低下を改善
- `scale_pos_weight`パラメータ調整
- より多様な馬を上位に選ぶ

#### C-3: アンサンブル
- 複数モデルの予測を組み合わせ
- 予測の多様性を確保

### 戦略D: レース選択

#### D-1: 高期待値レースのみ購入
- 予測が確信度の高いレースのみ
- 全レースに賭けない

#### D-2: 荒れるレース予測
- 配当が高くなりそうなレースを選別
- 人気薄の台頭を予測

---

## 次のアクション（優先度順）

### 優先度★★★（即実施）

1. **予想と人気の相関分析**
   - 予想上位3頭の平均人気順位を確認
   - 人気薄を選べているか検証

2. **ボックス買いシミュレーション**
   - 上位3頭ボックス（6点）の成績を算出
   - 収益性を確認

3. **1着・2着的中率の分析**
   - 3連単は無理でも、馬連・馬単の精度は？
   - より当てやすい券種への転換検討

### 優先度★★（次フェーズ）

4. **期待値ベース購入の実装**
   - 配当予測モデルの追加
   - 期待値計算ロジック

5. **ランク学習モデルの訓練**
   - LightGBM Ranker の試行
   - 順位予測の精度向上

### 優先度★（研究フェーズ）

6. **他の券種への転換**
   - 3連単以外（3連複、馬連等）の検討
   - 複数券種の組み合わせ

7. **作戦２以降の開発**
   - 異なるアプローチの実験
   - アンサンブル候補の蓄積

---

## 結論

### 現状認識

✅ **モデルの予測能力は悪くない**
- ROC-AUC 84%は優秀
- 上位馬の選定は的確

❌ **しかし収益化には不十分**
- 3連単1点買いは厳しすぎる
- 人気馬偏重で配当が低い

### 推奨事項

**短期（すぐ実施）**:
1. 購入方法の改善（ボックス・流し等）を試す
2. 人気との相関を分析し、人気薄を選ぶ工夫

**中期（Phase 2）**:
1. 期待値ベースの購入戦略
2. ランク学習モデルの導入

**長期（Phase 3以降）**:
1. 複数作戦のアンサンブル
2. より高配当を狙える手法の開発

### 次のステップ

作戦１はこのままでは収益化困難ですが、改善余地は十分にあります。
まずは**購入方法の工夫**から始め、それでも厳しければ**モデル改善**に進むのが賢明です。

---

**作成日**: 2025-11-20
**作成者**: Claude Code + d131
