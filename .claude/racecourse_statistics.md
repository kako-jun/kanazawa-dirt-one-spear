# 競馬場統計 - 金沢競馬場の「場所」としての魅力

## 概要

金沢競馬場という「場所」に着目し、開催データから興味深い統計情報を抽出・可視化する。
「そういえば知らなかった」という発見を提供し、競馬場への理解と愛着を深める。

## 機能一覧

### 1. 年間レース数の推移

**目的**: 金沢競馬の歴史と規模の変化を可視化

**表示内容**:
- **年別総レース数**: 2015年〜2025年の推移グラフ
- **年別開催日数**: 開催日の増減傾向
- **1日あたり平均レース数**: 時代による変化
- **注目ポイント**:
  - 最もレース数が多かった年
  - 最も少なかった年
  - コロナ禍の影響（2020-2021年）
  - トレンド分析（増加傾向？減少傾向？）

**グラフ例**:
```
2015年: 67日 / 720レース (平均10.7R/日)
2016年: 70日 / 756レース (平均10.8R/日)
...
2022年: 73日 / 811レース (平均11.1R/日)
```

**API設計**:
```
GET /api/statistics/yearly-races
Response: [
  {
    "year": 2022,
    "total_days": 73,
    "total_races": 811,
    "avg_races_per_day": 11.1,
    "total_entries": 7834,
    "avg_entries_per_race": 9.7
  }
]
```

### 2. 月別・曜日別の開催傾向

**目的**: 金沢競馬の開催パターンを明らかにする

**表示内容**:
- **月別開催日数**: 4月〜11月のヒートマップ
- **曜日別開催頻度**: 日曜日が多い？火曜日は？
- **月別レース数**: どの月が盛り上がる？
- **興味深い発見**:
  - 「火曜開催は〇〇日あった」
  - 「GW・お盆は連続開催」
  - 「11月が最も開催が多い」

**ビジュアル**:
- カレンダー形式でヒートマップ表示
- 曜日別の円グラフ

**API設計**:
```
GET /api/statistics/monthly-races?year=2024
Response: {
  "by_month": {
    "4": 8,  // 4月は8日開催
    "5": 10,
    ...
  },
  "by_weekday": {
    "Sunday": 35,
    "Tuesday": 30,
    "Monday": 8,
    ...
  }
}
```

### 3. 距離別レース数の分布

**目的**: 金沢競馬の距離構成を分析

**表示内容**:
- **距離別レース数**: 1400m、1500m、1700m、2000m など
- **距離別割合**: 円グラフで可視化
- **距離別平均出走頭数**: 短距離ほど多い？
- **年度別変化**: 距離構成の変遷
- **興味深い発見**:
  - 「1500mが最も多い（全体の35%）」
  - 「2000m以上の長距離は年間〇〇レースのみ」

**API設計**:
```
GET /api/statistics/distance-distribution?year=2024
Response: [
  {
    "distance": 1500,
    "race_count": 284,
    "percentage": 35.0,
    "avg_entries": 9.8
  },
  {
    "distance": 1400,
    "race_count": 215,
    "percentage": 26.5,
    "avg_entries": 10.2
  }
]
```

### 4. 馬場状態・天候の統計

**目的**: 金沢の気候と馬場の特徴を明らかに

**表示内容**:
- **馬場状態の割合**: 良・稍重・重・不良
- **天候の割合**: 晴・曇・雨・雪
- **月別馬場状態**: 梅雨時期は重馬場が多い？
- **馬場×天候のクロス集計**: 「晴れでも稍重」など
- **興味深い発見**:
  - 「良馬場は全体の68%」
  - 「10月〜11月は良馬場が多い」
  - 「雨の日でも開催中止はほぼない」

**API設計**:
```
GET /api/statistics/track-condition?year=2024
Response: {
  "track_condition": {
    "良": 556,
    "稍重": 182,
    "重": 63,
    "不良": 10
  },
  "weather": {
    "晴": 450,
    "曇": 280,
    "雨": 71,
    "雪": 10
  }
}
```

### 5. 出走頭数の統計

**目的**: レースの規模感を把握

**表示内容**:
- **平均出走頭数の推移**: 年別・月別
- **出走頭数の分布**: 5頭〜12頭
- **距離別の出走頭数**: 短距離ほど多頭数？
- **最大・最小出走頭数のレース**: 記録として
- **興味深い発見**:
  - 「平均出走頭数は9.7頭」
  - 「5頭以下のレースは年間〇〇回」
  - 「12頭立てのレースは年間〇〇回」

**API設計**:
```
GET /api/statistics/entries-stats?year=2024
Response: {
  "avg_entries": 9.7,
  "max_entries": 12,
  "min_entries": 5,
  "distribution": {
    "5": 12,
    "6": 45,
    "7": 89,
    "8": 156,
    "9": 201,
    "10": 189,
    "11": 98,
    "12": 21
  }
}
```

### 6. レース名の種類と傾向

**目的**: ユニークなレース名から金沢競馬の文化を感じる

**表示内容**:
- **特別レース一覧**: 「金沢スプリント」「北國王冠」など
- **ユニークなレース名**: 記念レースやスポンサー名
- **レース名の分類**:
  - 地名・観光地（例: 兼六園賞、白山賞）
  - 季節・花（例: 桜花賞、紅葉賞）
  - 記念レース（例: 誕生日記念、結婚記念）
  - スポンサーレース（例: 楽天競馬賞）
- **年度別の傾向**: 記念レース数の推移

**興味深い発見**:
- 「最も多いレース名は『Ｃ１〜』（クラス分けレース）」
- 「記念レース名は年間〇〇種類」
- 「個人の記念日レースが〇〇回」

**API設計**:
```
GET /api/statistics/race-names?year=2024
Response: {
  "special_races": [
    {"name": "金沢スプリント", "count": 1},
    {"name": "北國王冠", "count": 1}
  ],
  "categories": {
    "地名": 45,
    "季節": 32,
    "記念": 28,
    "スポンサー": 15,
    "クラス分け": 691
  }
}
```

### 7. 時間帯別のレース傾向（データがあれば）

**目的**: 1日のスケジュールを分析

**表示内容**:
- **レース間隔**: 平均30分？
- **第1レースの開始時間**: 通常14時？
- **最終レースの終了時間**: 19時台？
- **興味深い発見**:
  - 「第1レースは14:00が最多」
  - 「メインレースは16:30頃」

### 8. 歴史的トピックス

**目的**: 金沢競馬の歴史を振り返る

**表示内容**:
- **最も多くレースが行われた日**: 〇〇年〇月〇日（12R開催）
- **過去最長距離レース**: 〇〇m
- **過去最多出走頭数**: 〇頭立て
- **連続開催記録**: GW・お盆の連続〇日開催
- **タイムライン表示**: 主要な出来事

### 9. 比較統計

**目的**: 他競馬場や中央競馬との比較で金沢の特徴を浮き彫りに

**表示内容**:
- **地方競馬との比較**:
  - 大井競馬、浦和競馬との開催日数比較
  - 平均出走頭数の比較
- **中央競馬（JRA）との比較**:
  - 開催パターンの違い
  - 距離設定の違い
- **興味深い発見**:
  - 「金沢は地方競馬で〇番目に開催日数が多い」
  - 「1500mの比率が高い」

### 10. 来客数統計

**目的**: 金沢競馬場の集客力と人気度を可視化

**表示内容**:
- **年別総来客数推移**: 2015年〜2025年のグラフ
- **1日あたり平均来客数**: 開催日ごとの来場者数
- **月別来客数**: 春〜秋の季節変動
- **曜日別来客数**: 日曜日 vs 平日の差
- **特別レース時の来客数**: 重賞レースでの集客効果
- **興味深い発見**:
  - 「GW・お盆は来客数が2倍に」
  - 「年間総来客数は〇〇万人」
  - 「1日あたり平均〇〇人が来場」
  - 「北國王冠は年間最多の〇〇人」
  - 「コロナ前後での来客数変化」

**API設計**:
```
GET /api/statistics/attendance?year=2024
Response: {
  "yearly_total": 125000,
  "avg_per_day": 1712,
  "by_month": {
    "4": 8500,
    "5": 15000,
    ...
  },
  "by_weekday": {
    "Sunday": 85000,
    "Tuesday": 30000,
    ...
  },
  "top_days": [
    {
      "date": "2024-05-05",
      "race_name": "北國王冠",
      "attendance": 4500
    }
  ]
}
```

### 11. 売上統計（馬券販売額）

**目的**: 金沢競馬の経済規模を明らかにする

**表示内容**:
- **年別総売上推移**: 売上高の年次変化
- **1日あたり平均売上**: 開催日ごとの売上額
- **1レースあたり平均売上**: レース規模の把握
- **馬券種別売上比率**: 単勝・3連単・ワイドなどの内訳
- **月別売上傾向**: 季節要因の分析
- **興味深い発見**:
  - 「年間総売上は〇〇億円」
  - 「1日平均〇〇百万円の売上」
  - 「3連単が売上の〇〇%を占める」
  - 「特別レースは通常の〇倍の売上」
  - 「来客数と売上の相関関係」

**API設計**:
```
GET /api/statistics/sales?year=2024
Response: {
  "yearly_total": 1250000000,  // 12.5億円
  "avg_per_day": 17123287,
  "avg_per_race": 1541206,
  "by_bet_type": {
    "単勝": 150000000,
    "複勝": 120000000,
    "馬連": 200000000,
    "馬単": 180000000,
    "ワイド": 160000000,
    "3連複": 220000000,
    "3連単": 220000000
  },
  "top_days": [
    {
      "date": "2024-11-03",
      "race_name": "北國王冠",
      "sales": 45000000
    }
  ]
}
```

### 12. 総配当統計

**目的**: 払戻金の規模と還元率を分析

**表示内容**:
- **年別総配当額**: 払戻総額の推移
- **平均還元率**: 売上に対する配当率（通常75%前後）
- **高額配当ランキング**: 過去最高配当のレース
- **馬券種別配当統計**: 平均配当額（単勝、3連単など）
- **的中率の推定**: 各馬券種別の的中本数推定
- **興味深い発見**:
  - 「年間配当総額は〇〇億円（還元率〇〇%）」
  - 「3連単の平均配当は〇〇円」
  - 「過去最高配当は〇〇万円（〇年〇月）」
  - 「100円が平均〇〇円になって返ってくる」
  - 「配当10万円超えは年間〇〇回」

**API設計**:
```
GET /api/statistics/payouts?year=2024
Response: {
  "yearly_total": 937500000,  // 9.375億円（75%還元）
  "return_rate": 0.75,
  "avg_by_bet_type": {
    "単勝": 280,
    "複勝": 150,
    "馬連": 1450,
    "馬単": 2100,
    "ワイド": 580,
    "3連複": 3200,
    "3連単": 8450
  },
  "top_payouts": [
    {
      "date": "2024-07-15",
      "race_name": "Ｃ１四",
      "bet_type": "3連単",
      "payout": 456780,
      "odds": 4567.8
    }
  ],
  "high_payout_count": {
    "> 10000": 234,
    "> 50000": 45,
    "> 100000": 12,
    "> 500000": 2
  }
}
```

### 13. 経済指標の総合分析

**目的**: 金沢競馬場の経営状況と社会的価値を示す

**表示内容**:
- **1人あたり平均購入額**: 来客数÷売上
- **売上と来客数の相関**: 来客増加が売上増につながるか
- **経年変化の比較**: 来客・売上・配当の3軸グラフ
- **地方競馬全体との比較**: 金沢の位置づけ
- **興味深い発見**:
  - 「来場者1人あたり平均〇〇円購入」
  - 「売上は減少傾向だが来客数は横ばい」
  - 「配当還元率は常に75%前後で安定」
  - 「金沢競馬の年間経済効果は〇〇億円」

**API設計**:
```
GET /api/statistics/economic-indicators?year=2024
Response: {
  "avg_bet_per_visitor": 10000,
  "correlation_attendance_sales": 0.82,
  "economic_impact": {
    "direct": 1250000000,      // 売上
    "indirect": 2500000000,    // 周辺消費推定
    "jobs_supported": 150      // 雇用数推定
  },
  "year_over_year": {
    "attendance_change": -0.05,  // -5%
    "sales_change": -0.03,       // -3%
    "avg_bet_change": 0.02       // +2%
  }
}
```

### 14. リアルタイム統計（ダッシュボード）

**目的**: 現時点の統計を一目で把握

**表示内容**:
- 今年度の開催日数（累計）
- 今年度の総レース数（累計）
- 今年度の平均出走頭数
- **今年度の総来客数**
- **今年度の総売上**
- **今年度の総配当**
- 今月の開催予定
- 直近1週間の馬場状態
- 進捗率（例: 今年度の75%が終了）

## データベース設計

### 新しいテーブル

**racecourse_statistics** (競馬場統計キャッシュ):
```sql
CREATE TABLE racecourse_statistics (
    year INTEGER,
    month INTEGER,
    stat_type VARCHAR,  -- 'yearly', 'monthly', 'distance', etc.
    key VARCHAR,
    value_int INTEGER,
    value_float FLOAT,
    value_json TEXT,
    updated_at TIMESTAMP,
    PRIMARY KEY (year, month, stat_type, key)
);
```

## バックエンド実装

### 新しいAPI

**`/api/statistics/*`**:
- `GET /api/statistics/yearly-races` - 年別レース数
- `GET /api/statistics/monthly-races?year=2024` - 月別統計
- `GET /api/statistics/distance-distribution?year=2024` - 距離別分布
- `GET /api/statistics/track-condition?year=2024` - 馬場・天候統計
- `GET /api/statistics/entries-stats?year=2024` - 出走頭数統計
- `GET /api/statistics/race-names?year=2024` - レース名分類
- `GET /api/statistics/attendance?year=2024` - 来客数統計
- `GET /api/statistics/sales?year=2024` - 売上統計
- `GET /api/statistics/payouts?year=2024` - 配当統計
- `GET /api/statistics/economic-indicators?year=2024` - 経済指標総合
- `GET /api/statistics/dashboard` - ダッシュボード（全体サマリー）

### 集計バッチ

**`backend/app/statistics.py`**:
```python
def calculate_yearly_stats(year: int):
    """年間統計を計算"""
    pass

def calculate_monthly_stats(year: int, month: int):
    """月別統計を計算"""
    pass

def calculate_distance_distribution(year: int):
    """距離別分布を計算"""
    pass
```

## フロントエンド実装

### 新しいページ

- `/statistics` - 統計トップページ（ダッシュボード）
- `/statistics/yearly` - 年別推移グラフ
- `/statistics/calendar` - カレンダー形式の開催傾向
- `/statistics/distances` - 距離別分析
- `/statistics/conditions` - 馬場・天候分析
- `/statistics/history` - 歴史的トピックス

### 新しいコンポーネント

- `YearlyChart.tsx` - 年別推移の折れ線グラフ
- `MonthlyHeatmap.tsx` - 月別ヒートマップ
- `DistributionChart.tsx` - 円グラフ・棒グラフ
- `StatCard.tsx` - 統計カード（数値表示）
- `TimelineView.tsx` - 歴史タイムライン

## グラフライブラリ

**推奨**: Chart.js または Recharts
- 折れ線グラフ（年別推移）
- 棒グラフ（月別、距離別）
- 円グラフ（馬場状態、天候）
- ヒートマップ（カレンダー）

## 実装優先順位

### フェーズ1: 基礎統計（即時実装可能）
1. 年別レース数推移
2. 月別・曜日別開催傾向
3. 距離別レース数分布
4. 馬場状態・天候統計

### フェーズ2: 詳細分析
5. 出走頭数統計
6. レース名分類
7. 比較統計（他競馬場）

### フェーズ3: 経済データ（データ取得後）
8. 来客数統計
9. 売上統計（馬券販売額）
10. 総配当統計
11. 経済指標の総合分析

### フェーズ4: 高度な機能
12. 時間帯別分析
13. 歴史的トピックス
14. リアルタイムダッシュボード

## 「そういえば知らなかった」発見例

実際のデータから抽出できる興味深い情報:

**レース・開催関連**:
- 「金沢競馬は年間約73日、800レース以上開催」
- 「火曜開催は年間30日以上」
- 「1500mが全体の35%を占める人気距離」
- 「良馬場は全体の約70%」
- 「平均出走頭数は9.7頭（年によって変動）」
- 「記念レース（個人名）は年間約30レース」
- 「11月が最も開催日数が多い月」
- 「GW・お盆は連続5日開催が多い」
- 「雪の日でも開催される（年1〜2回）」
- 「5頭立てのレースも年に数回ある」

**経済・来客関連**:
- 「年間総来客数は約12万人（1日平均1,700人）」
- 「年間売上は約12億円」
- 「来場者1人あたり平均1万円購入」
- 「3連単の平均配当は8,450円」
- 「10万円超えの配当は年間約12回」
- 「還元率は常に75%前後で安定」
- 「北國王冠の日は来客数・売上が通常の2〜3倍」
- 「金沢競馬の経済効果は年間約25億円（周辺消費含む）」

## UI/UXのポイント

### デザイン方針
- 数値だけでなく「発見」を強調
- グラフは色分けで直感的に
- 「へぇ〜！」と思わせる吹き出し表示
- 比較機能で違いを際立たせる

### インタラクティブ要素
- グラフにホバーで詳細表示
- 年度切り替えスライダー
- グラフの種類切り替え（棒グラフ⇔円グラフ）
- データのダウンロード機能（CSV）

## 参考デザイン

- スポーツ統計サイト（baseball-reference.com）
- 気象データサイト（気象庁）
- Google Analytics のダッシュボード
- JRA公式サイトの統計ページ

## 経済データの取得方法

### データソース

**来客数・売上・配当データ**は以下の方法で取得する:

1. **NAR公式サイトのスクレイピング**:
   - NAR公式ページに開催日ごとの売上・入場者数が掲載されている場合がある
   - URLパターン: `https://www.nar.or.jp/statistics/` など（要確認）

2. **地方競馬全国協会の公開資料**:
   - 年次報告書（PDFまたはHTML）
   - 月次統計レポート
   - これらから年間総計を取得し、レース数で按分推定

3. **金沢競馬場公式の発表**:
   - プレスリリース
   - 公式Twitter/SNSでの告知
   - 年度末の決算報告

4. **手動入力**:
   - 公式発表があった年度のみ、年間総計を手動でDBに登録
   - 日別・レース別は推定計算

### データ取得の優先順位

**フェーズ1（手動入力で年次データのみ）**:
- 年間総来客数
- 年間総売上
- 年間総配当
- 還元率

**フェーズ2（自動スクレイピングで日別データ）**:
- 開催日ごとの来客数
- 開催日ごとの売上
- 開催日ごとの配当

**フェーズ3（推定計算）**:
- レースごとの売上推定（1日の売上をレース数で按分）
- レースごとの来客数推定（曜日・時間帯で補正）

### データベースへの格納

**新しいテーブル: daily_statistics**:
```sql
CREATE TABLE daily_statistics (
    date DATE PRIMARY KEY,
    attendance INTEGER,       -- 来客数
    total_sales BIGINT,       -- 総売上（円）
    total_payout BIGINT,      -- 総配当（円）
    return_rate FLOAT,        -- 還元率
    data_source VARCHAR,      -- 'official', 'scraped', 'estimated'
    updated_at TIMESTAMP
);
```

### スクレイパーの実装

**`backend/app/scrapers/nar_statistics_scraper.py`**:
```python
import httpx
from bs4 import BeautifulSoup

class NARStatisticsScraper:
    """NAR公式から統計データをスクレイピング"""

    def scrape_yearly_stats(self, year: int) -> dict:
        """年間統計を取得"""
        # NAR公式の年次レポートページから取得
        pass

    def scrape_daily_stats(self, date: str) -> dict:
        """開催日ごとの統計を取得（可能なら）"""
        # 日別ページがあれば取得
        pass
```

## 技術的考慮事項

### キャッシング
- 統計データは1日1回更新
- ブラウザキャッシュを活用

### パフォーマンス
- 大量データはサーバー側で集計
- グラフは遅延読み込み

### レスポンシブ対応
- スマホでもグラフが見やすく
- タブレットでは横向き表示を推奨

### データの信頼性
- 公式発表データを最優先
- 推定データは明示的にラベル表示
- データソースを常に記録
