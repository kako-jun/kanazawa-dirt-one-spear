# スクレイピング特記事項

## 2025年データ収集

**実施日:** 2025-11-10〜11
**対象:** 2025年シーズン全59開催日、683レース

### 収集結果
- 出馬表HTML: 683件
- 結果HTML: 683件
- 合計データサイズ: 57MB
- データベースサイズ: 2.3MB

### 問題発生レース

#### 2025-04-22 第7レース（Ｃ１八）
- **症状:** 着順情報が取得できませんでした
- **出馬表:** 正常取得（10頭）
- **結果HTML:** 保存済み
- **考えられる原因:**
  - 結果ページのHTML構造が他のレースと異なる可能性
  - 「成績表」テーブルが存在しないか、別の形式
- **対応:** 要手動確認・パース処理の改善検討

### 統計
- 成功率: 682/683 = 99.85%
- 失敗: 1レース（着順情報のみ、HTML自体は保存済み）

---

## 2024年データ収集

（実施予定）

---

## 2023年データ収集

（実施予定）

---

## 2015-2022年データ収集

**実施日:** 2025-11-11〜12
**対象:** 2015-2022年の8年分、6,402レース

### 収集結果
- 出馬表HTML: 6,402件 (100%)
- 結果HTML: 6,391件 (99.8%)
- 合計データサイズ: 約700MB

### 年別内訳
- 2015年: 出馬表 751 / 結果 751 (100%)
- 2016年: 出馬表 813 / 結果 813 (100%)
- 2017年: 出馬表 822 / 結果 822 (100%)
- 2018年: 出馬表 800 / 結果 800 (100%)
- 2019年: 出馬表 812 / 結果 812 (100%)
- 2020年: 出馬表 797 / 結果 797 (100%)
- 2021年: 出馬表 796 / 結果 785 (98.6%)
- 2022年: 出馬表 811 / 結果 811 (100%)

### 問題発生レース

#### 2021-08-01 全11レース
- **症状:** 結果HTMLがサーバー側でエラーページを返す
- **出馬表:** 正常取得（11レース分）
- **結果HTML:** 取得不可（`<title>エラー</title>`）
- **考えられる原因:**
  - レース中止（天候不良など）
  - 結果データが公式サイトに存在しない
  - データベースに該当レコードが存在しない
- **対応:** 取得不可として記録。出馬表は保存済みなので後続処理で中止フラグ等を設定可能

### URL修正履歴
- **初期エラー:** `www2.keiba.go.jp` + `k_babaCode=23` で大量エラーHTML生成
- **修正後:** `www.keiba.go.jp` + `k_babaCode=22` で正常取得
- 参照元: `app/scrapers/nar_scraper.py` の正しいURL定義

### 統計
- 成功率: 6,391/6,402 = 99.83%
- 失敗: 11レース（2021-08-01のみ、サーバー側エラー）
